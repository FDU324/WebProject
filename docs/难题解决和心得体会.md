## 难题解决和心得体会

### 难题解决
1、服务器对客户端进行通知
- 在好友发送朋友圈后需要根据朋友圈类型对相关人员进行推送，可选方案有客户端轮询，socket，以及客户端发送一个请求后服务器对该请求阻塞，直到有新通知再返回
- 轮询会加重服务器负担
- 阻塞会在需要更新信息较多时，在服务器堆积大量请求
- 所以我们选择了socket作为交互方式，服务器维护当前所有在线用户的列表。如果对象用户在线，则直接通过socket推送；若离线，则将通知信息存储至数据库，等到对方上线时再进行推送

2、发送图片
- socket支持直接发送图片，但需要转码为base64，转码后发送服务器译码再保存，效果不理想
- 我们选择使用node的busboy模块作为上传控件，直接图片以二进制流的形式传输，省去了转码和译码的步骤

3、前后端同步
- 客户端进行操作后向服务器发送请求，需要确保服务器改动完成后再进行显示或通知，这是一个异步操作
- 为了确保在异步操作后执行，客户端将socket.emit包装成promise，等到服务器返回确认信号后再执行处理函数

4、重连
- 在网络信号出现问题时，socket会断开连接，而当网络信号恢复时，socket会自动进行重连，然而重连相当于建立了一次新的socket连接，服务器端原本的在线用户列表因而失效
- 原本的解决方案是建立连接时判断当前用户是否在在线用户列表中有记录，如果有记录则说明是重连用户，将原记录覆盖
- 然而之后在解决用户顶替问题时，发现与这种解决方案冲突，最后选择优先解决顶替问题

### 心得体会

#### 徐凯文
- 这次pj，我主要负责后端代码的编写。之前对后端语言的使用，基本都是java+jsp或者php。这次pj使用了node作为后端，掌握了许多新知识，如promise，js模块化，socket通信等。相较于java，node有着轻量级、易部署等优势。在一些小型应用上，我认为node是一种十分适合的后端语言。

#### 王子珩
- 这次pj，我主要负责前端代码中如个人信息修改、分组功能、动态功能、图片服务、city-picker服务和部分UI设计，等方面的工作。最大的收获就是熟悉并基本掌握了AngularJS2+ionic2的前端开发框架，第一次发现原来可以这样开发移动端应用，刷新了我对web开发的认识；掌握了promise、class等ES6新特性的使用。同时通过实践，加深了对前后端分离、MVVM模式的认识，纠正了之前在项目开发中的错误习惯。

#### 王翀
- 通过这门课程以及这个pj，最主要的收获是改变了我对web前端开发的认识，同时让我了解到了web应用开发的前沿的技术。这次pj我主要做的是前端的一部分工作，我们使用了ionic+angular的框架，让我感受到目前的新技术的发展使得用web技术来开发手机app具有很高便捷性和跨平台性。在这学期一些web技术和框架的学习中，完全改变了我记忆中的web的开发方式，同时有一些很好地设计的理念和模式、一些模块化的架构我觉得也是非常值得去借鉴和学习的。这次pj我将以前书本上看的一些设计模式运用到了开发中，感觉很有收获，加深了对以往知识的理解。

#### 蒲实
- PJ我主要负责部分框架搭建和部分前后端代码。其中前端部分学习了`Angular2`这一`MVVM`式的框架，实践了模块化、依赖注入等等思想和模式，以及`SPA`和`Web APP`的开发。强类型`TypeScript`带来了编译的类型检查，加快了开发并减少了错误。`TSLint`和`JSLint`的使用帮助写出了更规范的代码。新的框架和库的出现都简化了开发，其背后优秀的设计模式和思维都值得学习
- 后端部分学习了`node`和`socket.io`的使用，`node`作为服务器轻量高效，同样用`JS`编写前后台减少了学习成本，同时更容易封装`RESTful`式服务。后端还使用了基于`ORM`架构的`Sequelize`，使得操作数据库更容易。基于`Promise`的开发，使我练习了大量异步代码。
- 开发过程也遇到不少问题如未统一前后端接口定义、开发前期代码结构混乱等等，这在以后的开发中都值得注意。
