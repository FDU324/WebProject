## 难题解决和心得体会

###难题解决
1、服务器对客户端进行通知
- 在好友发送朋友圈后需要根据朋友圈类型对相关人员进行推送，可选方案有客户端轮询，socket，以及客户端发送一个请求后服务器对该请求阻塞，直到有新通知再返回
- 轮询会加重服务器负担
- 阻塞会在需要更新信息较多时，在服务器堆积大量请求
- 所以我们选择了socket作为交互方式，服务器维护当前所有在线用户的列表。如果对象用户在线，则直接通过socket推送；若离线，则将通知信息存储至数据库，等到对方上线时再进行推送

2、发送图片
- socket支持直接发送图片，但需要转码为base64，转码后发送服务器译码再保存，效果不理想
- 我们选择使用node的busboy模块作为上传控件，直接图片以二进制流的形式传输，省去了转码和译码的步骤

3、前后端同步
- 客户端进行操作后向服务器发送请求，需要确保服务器改动完成后再进行显示或通知，这是一个异步操作
- 为了确保在异步操作后执行，客户端将socket.emit包装成promise，等到服务器返回确认信号后再执行处理函数

4、重连
- 在网络信号出现问题时，socket会断开连接，而当网络信号恢复时，socket会自动进行重连，然而重连相当于建立了一次新的socket连接，服务器端原本的在线用户列表因而失效
- 原本的解决方案是建立连接时判断当前用户是否在在线用户列表中有记录，如果有记录则说明是重连用户，将原记录覆盖
- 然而之后在解决用户顶替问题时，发现与这种解决方案冲突，最后选择优先解决顶替问题

###心得体会

####徐凯文
- 这次pj，我主要负责后端代码的编写。之前对后端语言的使用，基本都是java+jsp或者php。这次pj使用了node作为后端，掌握了许多新知识，如promise，js模块化，socket通信等。相较于java，node有着轻量级、易部署等优势。在一些小型应用上，我认为node是一种十分适合的后端语言。
